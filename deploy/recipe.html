<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rezept - Johann Lafer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Back Button -->
        <div class="back-button">
            <a href="index.html">‚Üê Zur√ºck zu allen Rezepten</a>
        </div>

        <!-- Recipe Detail -->
        <div class="recipe-detail" id="recipeDetail">
            <!-- Recipe content will be loaded here by JavaScript -->
        </div>

        <!-- Action Buttons -->
        <div class="recipe-actions">
            <button onclick="window.print()" class="btn-action">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M6 9V2h12v7M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"/>
                    <path d="M6 14h12v8H6z"/>
                </svg>
                Drucken
            </button>
            <button onclick="shareRecipe()" class="btn-action">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/>
                    <path d="M8.59 13.51l6.83 3.98M15.41 6.51l-6.82 3.98"/>
                </svg>
                Teilen
            </button>
        </div>

        <!-- Print-only styling -->
        <style media="print">
            .back-button, .recipe-actions, .footer { display: none; }
            body { font-size: 12pt; }
        </style>
    </div>

    <script src="recipe.js"></script>

    <!-- Iframe height communication for Shopify embed -->
    <script>
        // Detect if we're in an iframe
        const isInIframe = window.self !== window.top;

        // Add class to body and html if in iframe to hide scrollbar
        if (isInIframe) {
            document.body.classList.add('in-iframe');
            document.documentElement.classList.add('in-iframe');
        }

        // Scroll to top on page load
        window.addEventListener('load', () => {
            window.scrollTo({ top: 0, behavior: 'instant' });

            // Tell parent window to scroll to top too
            if (isInIframe) {
                window.parent.postMessage({
                    type: 'lafer-recipes-scroll-top'
                }, '*');
            }
        });

        if (isInIframe) {
            // Function to send height to parent
            function sendHeight() {
                // Wait a bit for layout to settle
                requestAnimationFrame(() => {
                    // Get the actual content height (container element)
                    const container = document.querySelector('.container');
                    const recipeDetail = document.querySelector('.recipe-detail');

                    // Check if mobile/tablet
                    const isMobile = window.innerWidth <= 768;
                    const extraPadding = isMobile ? 300 : 200; // More padding on mobile

                    let height;
                    if (recipeDetail && recipeDetail.offsetHeight > 0) {
                        // Use the recipe detail element height + padding
                        height = recipeDetail.offsetHeight + extraPadding;
                    } else if (container && container.offsetHeight > 0) {
                        // Fallback to container
                        height = container.offsetHeight + extraPadding;
                    } else {
                        // Last resort: use document measurements + padding
                        height = Math.max(
                            document.body.scrollHeight,
                            document.body.offsetHeight,
                            document.documentElement.scrollHeight
                        ) + extraPadding;
                    }

                    // Send to parent window (Shopify)
                    window.parent.postMessage({
                        type: 'lafer-recipes-height',
                        height: height
                    }, '*');

                    console.log('üìè Sent height to parent:', height, 'px (recipe detail, mobile:', isMobile + ')');
                });
            }

            // Send height aggressively on load (multiple times to ensure it's received)
            window.addEventListener('load', () => {
                sendHeight(); // Immediate
                setTimeout(sendHeight, 50);   // After 50ms
                setTimeout(sendHeight, 100);  // After 100ms
                setTimeout(sendHeight, 300);  // After 300ms
                setTimeout(sendHeight, 500);  // After 500ms
                setTimeout(sendHeight, 1000); // After 1s (final)
            });

            // Send immediately when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', sendHeight);
            } else {
                sendHeight(); // DOM already loaded
            }

            // Send height on resize
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(sendHeight, 150);
            });

            // Send height when content changes
            const observer = new MutationObserver(() => {
                sendHeight();
            });

            observer.observe(document.body, {
                childList: true,
                subtree: true,
                attributes: true
            });

            // Send height periodically (fallback) - more frequent in first 10 seconds
            let intervalCount = 0;
            const heightInterval = setInterval(() => {
                sendHeight();
                intervalCount++;

                // After 10 checks (10 seconds), slow down to every 3 seconds
                if (intervalCount === 10) {
                    clearInterval(heightInterval);
                    setInterval(sendHeight, 3000);
                }
            }, 1000);
        }
    </script>
</body>
</html>
